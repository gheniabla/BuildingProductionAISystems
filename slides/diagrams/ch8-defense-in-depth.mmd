flowchart TB
    TITLE["DEFENSE IN DEPTH FOR AI SYSTEMS"]

    L1["Layer 1: PERIMETER<br/>──────────────────<br/>WAF (Web Application Firewall)<br/>DDoS protection<br/>Rate limiting<br/>IP reputation filtering"]

    L2["Layer 2: INPUT VALIDATION<br/>─────────────────────────<br/>Schema validation (Pydantic)<br/>Length limits<br/>Character filtering<br/>Prompt injection detection"]

    L3["Layer 3: PRE-PROCESSING<br/>────────────────────────<br/>PII detection and masking<br/>Input normalization<br/>Language detection<br/>Content classification"]

    L4["Layer 4: MODEL CONTEXT<br/>───────────────────────<br/>System prompt hardening<br/>Context isolation<br/>Privilege separation<br/>RAG source validation"]

    L5["Layer 5: OUTPUT VALIDATION<br/>──────────────────────────<br/>Content filtering<br/>Format validation<br/>PII leakage detection<br/>Hallucination detection"]

    L6["Layer 6: ACTION AUTHORIZATION<br/>─────────────────────────────<br/>Tool/function call validation<br/>Least privilege enforcement<br/>Human-in-the-loop for sensitive actions<br/>Audit logging"]

    L7["Layer 7: MONITORING<br/>────────────────────<br/>Anomaly detection<br/>Attack pattern recognition<br/>Usage analytics<br/>Incident response automation"]

    TITLE --> L1 --> L2 --> L3 --> L4 --> L5 --> L6 --> L7

    classDef client fill:#3B82F6,stroke:#1D4ED8,color:#FFFFFF
    classDef gateway fill:#EF4444,stroke:#B91C1C,color:#FFFFFF
    classDef service fill:#4F46E5,stroke:#3730A3,color:#FFFFFF
    classDef data fill:#10B981,stroke:#047857,color:#FFFFFF
    classDef external fill:#F59E0B,stroke:#D97706,color:#FFFFFF
    classDef observability fill:#8B5CF6,stroke:#6D28D9,color:#FFFFFF

    class TITLE service
    class L1 gateway
    class L2 external
    class L3 client
    class L4 service
    class L5 data
    class L6 observability
    class L7 observability
